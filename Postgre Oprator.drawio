<mxfile host="app.diagrams.net" modified="2020-08-04T12:55:26.806Z" agent="5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36" etag="eK7W0hGOvz2EOnL2rZ1U" version="13.4.2" type="github" pages="3">
  <diagram id="e6y-2lSQlXqC9P7j0iec" name="CreateCluster-APIServer">
    <mxGraphModel dx="1787" dy="753" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-57" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="319.40999999999997" y="100" as="sourcePoint" />
            <mxPoint x="319.40999999999997" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-56" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="519.17" y="80" as="sourcePoint" />
            <mxPoint x="519.17" y="3820" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-3" value="API URL路由分发，目前有暴露64个接口" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="170" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-6" value="CreateClusterHandler" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-7" value="AuthCheck" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="170" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-8" value="Check Client &amp;amp; Server Version Match" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="270" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-9" value="CreateCluster" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="360" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-11" value="Response Return" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="460" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-13" value="CreateCluster" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="460" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-14" value="ClusterName Validate" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="460" y="170" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-15" value="ReplicaCount Validate" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="460" y="270" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-16" value="UserLable 参数提取" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="460" y="360" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-17" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;validateDataSourceParms&lt;/pre&gt;数据源参数检查&lt;br&gt;restoreFrom&lt;br&gt;retoreOption" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="460" y="460" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-20" value="检查PVC Size是否合法&lt;br&gt;Primary/Replica PVC&lt;br&gt;BackRest PVC&lt;br&gt;WAL PVC" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="555" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-21" value="检查CPU Mem参数Request Limit是否合法" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="660" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-22" value="BackuRest的CPU和Mem参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="750" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-23" value="PgBouncer的CPU和Mem参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="850" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-24" value="request.Tablespaces参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="950" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-25" value="集群TLS参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1040" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-26" value="用户参数组检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1140" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-27" value="Metric标记设置" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1230" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-28" value="ServiceType检查&lt;br&gt;Defualt/LoadBalance/NodePort" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1310" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-29" value="灾备实例参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1400" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-30" value="BackRest存储类型检查&lt;br&gt;S3/Local" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1490" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-31" value="BackRest存储类型检查&lt;br&gt;S3/Local" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1580" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-32" value="BackRest StorageConfig&lt;br&gt;检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1660" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-33" value="是否有缺省参数组，有设置" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1750" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-34" value="主StorageConfig检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1840" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-35" value="WAL Size和StorageConfig加查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="1930" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-36" value="NodeLabe检查及提取" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2030" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-37" value="NodeLabe检查及提取" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2130" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-38" value="从StorageConfig检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2230" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-39" value="PgBouncer安装及replica&lt;br&gt;参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2330" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-40" value="Pod AntiAffinity参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2430" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-41" value="PgBouncer Pod AntiAffinity参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2530" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-42" value="主从同步复制参数加查及&lt;br&gt;标签设置" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2630" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-43" value="BackRestS3URIStyle检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2720" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-44" value="开始准备CRD instance" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2820" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-45" value="SecretFrom参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="2923" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-46" value="Policies参数检查" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="3030" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-47" value="创建超级用户Secret" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="3130" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-48" value="创建Replication用户Secret" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="3230" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-49" value="创建default User用户Secret" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="3330" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-50" value="创建collect User用户Secret" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="3420" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-51" value="创建BackRest的S3和SSH的Secret" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="3520" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-52" value="为新cluster创建workflow，id作为response参数返回" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="3620" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-53" value="为集群创建CRD&lt;br&gt;pgcluster" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="3720" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-54" value="return" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="475" y="3820" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-58" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#FF3333;" edge="1" parent="1" source="yWhdLjkU5JAQqWD6CEfC-55" target="yWhdLjkU5JAQqWD6CEfC-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-55" value="&lt;span&gt;API Router&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-59" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="yWhdLjkU5JAQqWD6CEfC-9" target="yWhdLjkU5JAQqWD6CEfC-13">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="200" as="sourcePoint" />
            <mxPoint x="250" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yWhdLjkU5JAQqWD6CEfC-62" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;strokeWidth=1;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="320" y="-200" width="20" height="480" as="geometry" />
        </mxCell>
        <mxCell id="2" value="API Server" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="295" y="10" width="70" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="2LHnsUQI_TxQHrFFFeV_" name="Operator Arch">
    <mxGraphModel dx="2007" dy="1110" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-0" />
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-1" parent="5SKbVsiYGQw5b-h0bSiV-0" />
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-16" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="5SKbVsiYGQw5b-h0bSiV-1" source="5SKbVsiYGQw5b-h0bSiV-18" target="5SKbVsiYGQw5b-h0bSiV-15">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="870" y="530" as="sourcePoint" />
            <mxPoint x="920" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-2" value="pgtaskController" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="250" y="530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-3" value="pgclusterController" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="440" y="530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-4" value="pgreplicaController" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="630" y="530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-5" value="pgpolicyController" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="820" y="530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-6" value="podControl&lt;span style=&quot;color: rgba(0 , 0 , 0 , 0) ; font-family: monospace ; font-size: 0px&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22pgpolicyController%22%20style%3D%22rounded%3D1%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3BstrokeWidth%3D1%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%22390%22%20y%3D%22340%22%20width%3D%22120%22%20height%3D%2260%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;ler" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="1000" y="530" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-7" value="jobControl&lt;span style=&quot;color: rgba(0 , 0 , 0 , 0) ; font-family: monospace ; font-size: 0px&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22pgpolicyController%22%20style%3D%22rounded%3D1%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3BstrokeWidth%3D1%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%22390%22%20y%3D%22340%22%20width%3D%22120%22%20height%3D%2260%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;ler" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="1170" y="530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-8" value="&lt;span&gt;onAdd&lt;/span&gt;&lt;br&gt;&lt;span&gt;onUpdate&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;span&gt;onDelete&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;align=left;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="270" y="610" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-9" value="&lt;span&gt;onAdd&lt;/span&gt;&lt;br&gt;&lt;span&gt;onUpdate&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;span&gt;onDelete&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;RunWorker&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;align=left;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="470" y="610" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-10" value="&lt;span&gt;onAdd&lt;/span&gt;&lt;br&gt;&lt;span&gt;onUpdate&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;span&gt;onDelete&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;align=left;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="660" y="610" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-11" value="&lt;span&gt;onAdd&lt;/span&gt;&lt;br&gt;&lt;span&gt;onUpdate&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;span&gt;onDelete&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;align=left;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="850" y="610" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-12" value="&lt;span&gt;onAdd&lt;/span&gt;&lt;br&gt;&lt;span&gt;onUpdate&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;span&gt;onDelete&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;align=left;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="1027" y="610" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-13" value="&lt;span&gt;onAdd&lt;/span&gt;&lt;br&gt;&lt;span&gt;onUpdate&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;span&gt;onDelete&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;align=left;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="1195" y="610" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-14" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;addControllerGroup&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="720" y="370" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-15" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;strokeWidth=1;rotation=90;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="769.93" y="2.5" width="20" height="980" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-17" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;NewControllerManager&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="720" y="180" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-18" value="Main" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="720" y="90" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5SKbVsiYGQw5b-h0bSiV-19" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;controllerManager.AddGroup&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="5SKbVsiYGQw5b-h0bSiV-1">
          <mxGeometry x="720.0000000000001" y="260" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="xMILbbspwZ0wlmzrvvVz" name="pgcluster Operator">
    <mxGraphModel dx="3513" dy="1943" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="Tet4A5Ykn7ojSv5wKa61-0" />
        <mxCell id="Tet4A5Ykn7ojSv5wKa61-1" parent="Tet4A5Ykn7ojSv5wKa61-0" />
        <mxCell id="WuodhJGJsOka3TGEAUCe-1" value="获取cluster，查看状态如果为 processed不处理" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="250" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-2" value="将cluster obj放入队列" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="250" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-3" value="onAdd" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="250" y="230" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-4" value="onDelete" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="450" y="230" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-5" value="onUpdate" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="660" y="230" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-6" value="RunWorker" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="850" y="230" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-7" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;waitForShutdown&lt;/span&gt;&lt;/pre&gt;判定是否接受到stop信号，是则标记退出" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="850" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-8" value="&lt;span style=&quot;background-color: rgb(43 , 43 , 43) ; color: rgb(169 , 183 , 198) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9pt&quot;&gt;processNextItem&lt;br&gt;&lt;/span&gt;循环处理新增的Item" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="850" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2" value="&lt;div&gt;RunWorker是一个长时间运行的函数，它将连续调用&lt;/div&gt;&lt;div&gt;processNextWorkItem函数用于读取和处理消息&lt;span&gt;工作队列。&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="745" y="180" width="330" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-9" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;processNextItem&lt;/span&gt;&lt;/pre&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1060" y="230" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-10" value="检查是否标记退出，是则退出循环" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1060" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-11" value="判定pgcluster相关的Deployment是否已经创建，是则退出不处理；" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1060" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-12" value="判定pgcluster是否已经创建，否则退出不处理；重试" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1060" y="510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#FF3333;" edge="1" parent="Tet4A5Ykn7ojSv5wKa61-1" source="WuodhJGJsOka3TGEAUCe-15" target="WuodhJGJsOka3TGEAUCe-47">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-15" value="RestoreFrom！=“”&lt;br&gt;是备份恢复" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1060" y="610" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-16" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;AddBootstrapRepo&lt;/span&gt;&lt;/pre&gt;创建BackRestRepo的Deployment" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1060" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-17" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;AddBootstrapRepo&lt;/span&gt;&lt;/pre&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1250" y="230" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-18" value="判定restoreFrom的cluster的BackRest是否创建" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1250" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-19" value="&lt;span style=&quot;background-color: rgb(43 , 43 , 43) ; color: rgb(169 , 183 , 198) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9pt&quot;&gt;CreateRepoDeployment&lt;br&gt;&lt;/span&gt;创建Repo Deployment" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1250" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-20" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;AddClusterBootstrap&lt;/pre&gt;处理bootstrapping" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1060" y="820" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-21" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;AddClusterBootstrap&lt;/pre&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1520" y="235" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-22" value="创建PGHAConfigMap" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1520" y="335" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-23" value="&lt;pre style=&quot;background-color: rgb(43 , 43 , 43) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9pt&quot;&gt;&lt;font color=&quot;#ffd966&quot;&gt;CreateMissingPostgreSQLVolumes&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 9pt&quot;&gt;&lt;span style=&quot;background-color: rgb(255 , 255 , 255)&quot;&gt;创建pvc dataVolume walVolume tablespaceVolume&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1520" y="425" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-24" value="添加BootstrapJob&lt;br&gt;&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;addClusterBootstrapJob&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1520" y="515" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-25" value="设置cluster的状态为&lt;br&gt;&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;PgclusterStateBootstrapping&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1520" y="605" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-26" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=-0.017;entryY=0.663;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="Tet4A5Ykn7ojSv5wKa61-1" source="WuodhJGJsOka3TGEAUCe-16" target="WuodhJGJsOka3TGEAUCe-17">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1290" y="661" as="sourcePoint" />
            <mxPoint x="1380" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-27" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=-0.033;entryY=0.625;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="Tet4A5Ykn7ojSv5wKa61-1" source="WuodhJGJsOka3TGEAUCe-20" target="WuodhJGJsOka3TGEAUCe-21">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1330" y="530" as="sourcePoint" />
            <mxPoint x="1380" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-28" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;addClusterBootstrapJob&lt;/span&gt;&lt;/pre&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1790" y="235" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-29" value="创建Bootstrap的Job Spec&lt;br&gt;&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;getBootstrapJobFields&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1790" y="340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-30" value="如果WAL stroragetype设置，&lt;br&gt;&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;AddWALVolumeAndMountsToPostgreSQL&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1790" y="425" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-31" value="重置容器镜像" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1790" y="515" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-34" value="发送给kubeAPI创建Job" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1790" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-37" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;entryX=0;entryY=1;entryDx=0;entryDy=0;exitX=1;exitY=0.25;exitDx=0;exitDy=0;" edge="1" parent="Tet4A5Ykn7ojSv5wKa61-1" source="WuodhJGJsOka3TGEAUCe-24" target="WuodhJGJsOka3TGEAUCe-28">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1120" y="510" as="sourcePoint" />
            <mxPoint x="1170" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-38" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;getBootstrapJobFields&lt;/span&gt;&lt;/pre&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="2020" y="235" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-39" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;getClusterDeploymentFields&lt;/pre&gt;&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;准备BootstrapFiles&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="2020" y="340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-40" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;getClusterDeploymentFields&lt;/pre&gt;" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="2240" y="235" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-41" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;" edge="1" parent="Tet4A5Ykn7ojSv5wKa61-1" source="WuodhJGJsOka3TGEAUCe-29" target="WuodhJGJsOka3TGEAUCe-38">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1910" y="430" as="sourcePoint" />
            <mxPoint x="1960" y="380" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-42" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;" edge="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2130" y="339.99554203661944" as="sourcePoint" />
            <mxPoint x="2248.9922052054385" y="290.84292023855016" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-43" value="获取restore opts参数&lt;br&gt;调整" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="2020" y="425" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-44" value="判定源Cluster是否存在，及状态是否是shutdown" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="2020" y="515" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-45" value="准备环境变量" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="2020" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-46" value="如果是S3上恢复，准备S3环境变量" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="2020" y="700" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-47" value="设置pgcluter的状态为&lt;br&gt;pgClusterStateProcessed" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1060" y="940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-48" value="AddClusterBase" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;fillColor=#d80073;strokeColor=#A50040;fontColor=#ffffff;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1060" y="1050" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-49" value="AddClusterBase" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=1;fillColor=#d80073;strokeColor=#A50040;fontColor=#ffffff;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="860" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-52" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF3333;" edge="1" parent="Tet4A5Ykn7ojSv5wKa61-1" source="WuodhJGJsOka3TGEAUCe-50" target="WuodhJGJsOka3TGEAUCe-51">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-50" value="&lt;br&gt;&lt;span style=&quot;background-color: rgb(43 , 43 , 43) ; color: rgb(169 , 183 , 198) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9pt&quot;&gt;CreateMissingPostgreSQLVolumes&lt;br&gt;&lt;/span&gt;创建PVC" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="970" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-51" value="&lt;span style=&quot;background-color: rgb(43 , 43 , 43) ; color: rgb(169 , 183 , 198) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9pt&quot;&gt;addClusterCreateMissingService&lt;/span&gt;建Service" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="1078" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-53" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;CreatePGHAConfigMap&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="1180" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-54" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;annotateBackrestSecret&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="1290" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-55" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;addClusterDeployments&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="1410" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WuodhJGJsOka3TGEAUCe-56" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;ScaleClusterDeployments&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="1530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-2" value="EventClusterCreate&lt;br&gt;发送ClusterCreate事件" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="1610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-3" value="spec.Replicas !=&quot;&quot;&lt;br&gt;创建replica" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="1710" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-4" value="为每一个Replicas创建一个CRD，准备spec" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="1800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-5" value="发送给KubeAPI创建" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1460" y="1890" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-6" value="准备ClusterSpec的结构&lt;br&gt;IsInit = True" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="2240" y="340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-8" value="&lt;div&gt;AddClusterBase为集群创建所有部署(以及各种其他支持)&lt;/div&gt;&lt;div&gt;资源，比如Service,ConfigMap,Secret等等)，但是将它们缩放为0。这&lt;/div&gt;&lt;div&gt;. 确保在需要时存在所有部署，以正确编排初始化&lt;/div&gt;&lt;div&gt;/cluster，例如，我们需要确保主DB部署资源已经创建&lt;/div&gt;&lt;div&gt;使repo部署变成online，因为这将使主数据库Online需使用。&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="1350" y="760" width="380" height="80" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-9" value="判定cluster State ==&amp;nbsp;&lt;br&gt;&lt;span style=&quot;color: rgb(152 , 118 , 170) ; font-style: italic ; background-color: rgb(43 , 43 , 43) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9pt&quot;&gt;PgclusterStateBootstrapped&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="640" y="345" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-12" value="AddClusterBase" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;fillColor=#d80073;strokeColor=#A50040;fontColor=#ffffff;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="660" y="480" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-13" value="True" style="endArrow=classic;html=1;strokeColor=#FF3333;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="Tet4A5Ykn7ojSv5wKa61-1" source="OV9-m6dmQ-1NdaY5KtbN-9" target="OV9-m6dmQ-1NdaY5KtbN-12">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="790" y="560" as="sourcePoint" />
            <mxPoint x="840" y="510" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-14" value="&lt;span&gt;需要shutdown？&lt;br&gt;&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="640" y="585" width="160" height="65" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-15" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;ShutdownCluster&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="660" y="680" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-16" value="&lt;span&gt;需要startup？&lt;br&gt;&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="640" y="780" width="160" height="65" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-17" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 9.0pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 9pt&quot;&gt;StartupCluster&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="660" y="880" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-18" value="&lt;span&gt;autofail 标记改变&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="640" y="970" width="160" height="65" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-21" value="&lt;font color=&quot;#000000&quot;&gt;修改autofail标记&lt;br&gt;ToogleAutoFailover&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#FFFFFF;strokeWidth=1;fillColor=none;gradientColor=none;fontColor=#FFFFFF;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="660" y="1078" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-22" value="&lt;span&gt;Standby状态修改&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="640" y="1170" width="160" height="65" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-23" value="&lt;font color=&quot;#000000&quot;&gt;disable or enable&lt;br&gt;Standby&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#FFFFFF;strokeWidth=1;fillColor=none;gradientColor=none;fontColor=#FFFFFF;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="660" y="1260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-24" value="&lt;span&gt;deepEqual查看其它字段是否&lt;br&gt;修改&lt;br&gt;如resource，limites等&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="640" y="1350" width="160" height="65" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-25" value="&lt;font color=&quot;#000000&quot;&gt;修改Resource&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#FFFFFF;strokeWidth=1;fillColor=none;gradientColor=none;fontColor=#FFFFFF;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="660" y="1440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-26" value="&lt;span&gt;deepEqual查看其它字段是否&lt;br&gt;修改&lt;br&gt;如pgbackrest resource，limites等&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="640" y="1525" width="160" height="65" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-27" value="&lt;font color=&quot;#000000&quot;&gt;修改Resource&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#FFFFFF;strokeWidth=1;fillColor=none;gradientColor=none;fontColor=#FFFFFF;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="660" y="1630" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OV9-m6dmQ-1NdaY5KtbN-28" value="&lt;span&gt;deepEqual查看其它字段是否&lt;br&gt;修改&lt;br&gt;如pgbackrest resource，limites等&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=1;align=center;" vertex="1" parent="Tet4A5Ykn7ojSv5wKa61-1">
          <mxGeometry x="640" y="1730" width="160" height="65" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
